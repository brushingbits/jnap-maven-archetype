Ext.ns("Ext.ux.jnap");Ext.ux.jnap.CTemplate=Ext.extend(Ext.XTemplate,{components:[],constructor:function(a){Ext.ux.jnap.CTemplate.superclass.constructor.apply(this,[a]);this.init();},init:function(){}});Ext.ns("Ext.ux.jnap");Ext.ux.jnap.ComponentDataView=Ext.extend(Ext.DataView,{});Ext.reg("cdataview",Ext.ux.jnap.ComponentDataView);Ext.ns("Ext.ux.jnap");Ext.ux.jnap.ComponentUtils=function(){return{hideParent:function(b,a,d){var c=b.findParentByType(d);if(!c){throw String.format("The button {0} has no parent of type {1}.",b.id,d);}c.hide();},hideWindow:function(b,a){Ext.ux.jnap.ComponentUtils.hideParent(b,a,Ext.Window);}};}();Ext.ux.jnap.ExceptionDialog=function(){var c,a,g;var b=function(){if(!c){c=new Ext.Window({});}return c;};var f=function(){if(!a){a=new Ext.Panel({});}return a;};var e=function(){if(!g){g=new Ext.Button({});}return g;};var d=null;return{defaultTitle:"An unexpected exception was thrown.",show:function(k,j){j=j||{};var h=f();var i=e();if(Ext.isDefined(j.reportHandler)){d=j.reportHandler;i.on("click",d);h.add(i);}else{if(h.findById(i.id)){if(d){i.un("click",d);}h.remove(i);}}getWindow().show();}};}();Ext.ux.jnap.FloatingActions=Ext.extend(Ext.BoxComponent,{actions:[],initComponent:function(){Ext.ux.jnap.NotificationMessage.superclass.initComponent.call(this);this.addEvents();},onRender:function(){}});Ext.ns("Ext.ux.jnap");Ext.ux.jnap.ImageBox=Ext.extend(Ext.util.Observable,{mode:"single",imageSelector:".image-box"});Ext.ux.jnap.LinkButton=Ext.extend(Ext.Button,{baseCls:"ux-link-button",buttonSelector:"a:first-child",href:null,target:null,template:new Ext.Template(['<div id="{2}" class="{1}">','<a href="{0}">{3}</a>',"</div>"],{compiled:true}),getTemplateArgs:function(){return[this.href,this.baseCls,this.id,this.text];},onClick:function(a){if(a.button!=0){return;}if(!this.disabled){this.fireEvent("click",this,a);if(this.handler){this.handler.call(this.scope||this,this,a);}}},enable:function(){this.el.removeClass(this.baseCls+"-disable");},disable:function(){this.el.addClass(this.baseCls+"-disable");}});Ext.reg("linkbutton",Ext.ux.jnap.LinkButton);Ext.ns("Ext.ux.jnap");Ext.ux.jnap.NavigationBar=Ext.extend(Ext.BoxComponent,{});Ext.ns("Ext.ux.jnap");Ext.ux.jnap.NotificationMessageType={INFO:"info",WARNING:"warning",ERROR:"error",SUCCESS:"success",CLEAR:"clear",CLEAR_DARK:"dark"};Ext.ux.jnap.NotificationMessage=Ext.extend(Ext.BoxComponent,{animateOnShow:true,animateOnHide:true,baseCls:"x-notification-msg",extraCls:undefined,closeable:false,closeTitle:"Dismiss message",destroyOnHide:true,dismissDelay:0,icon:undefined,iconCls:undefined,msg:"",shadow:false,title:null,type:Ext.ux.jnap.NotificationMessageType.CLEAR,initComponent:function(){Ext.ux.jnap.NotificationMessage.superclass.initComponent.call(this);this.addEvents("msgupdate","titleupdate");},onRender:function(b,a){if(!this.tpl){this.tpl=new Ext.XTemplate('<div class="{cls} {cls}-{type}">','<tpl if="closeable">','<input class="{cls}-close" type="image" value="" />',"</tpl>",'<span class="{cls}-icon"></span>','<div class="{cls}-content">','<tpl if="hasTitle"><h3 class="{cls}-title">{title}</h3></tpl>',"{msg}</div>","</div>",{compiled:true,disableFormats:true});}this.el=a?this.tpl.insertBefore(a,this._getTplArgs(),true):this.tpl.append(b,this._getTplArgs(),true);this.el.setVisibilityMode(Ext.Element.DISPLAY);if(this.shadow){this.el.addClass("shadow");}if(this.extraCls){this.el.addClass(this.extraCls);}if(this.id){this.el.dom.id=this.id;}if(this.title){this._titleEl=this.el.first("h3");}this._msgEl=this.el.first("div."+this.baseCls+"-content");if(this.closeable){this._closeEl=this.el.first("input."+this.baseCls+"-close");this._configCloseEl();}if(!this.hidden){this._doAfterShow();}},setMsg:function(a){this.msg=a;if(this.rendered){this._msgEl.update(this.msg);this.fireEvent("msgupdate",this,this.msg);}return this;},setTitle:function(a){this.title=a;if(this.rendered){if(a!=null){if(!this._titleEl){this._titleEl=this.el.insertFirst({tag:"h3",cls:this.baseCls+"-title"});}this._titleEl.update(this.title);}else{if(this._titleEl){this._titleEl.remove();delete this._titleEl;}}this.fireEvent("titleupdate",this,this.title);}return this;},setType:function(a){this.el.removeClass(this.type);this.el.addClass(a);this.type=a;},setCloseable:function(a){if(a&&!this._closeEl){this._closeEl=this.el.append({tag:"input",type:"image",cls:this.baseCls+"-close"});this._configCloseEl();}if(!a&&this._closeEl){this._removeCloseEl();}this.closeable=a;},update:function(a){if(Ext.isString(a)){this.setMsg(a);}else{if(Ext.isObject(a)){if(a.msg){this.setMsg(a.msg);}if(a.title){this.setTitle(a.title);}if(a.type){this.setType(a.type);}}}},onHide:function(){var a=this.el;if(!a){this._hideAlreadyTriggered=true;return false;}if(this._dismissTimer){window.clearTimeout(this._dismissTimer);}a.stopFx();if(this.animateOnHide){a.ghost("t",{useDisplay:true,callback:this._doOnHide.createDelegate(this)});}else{a.setVisible(false);this._doOnHide();}},onShow:function(){if(this.animateOnShow){this.el.syncFx();this.el.slideIn("t",{easing:"easeNone",duration:0.3,concurrent:true}).fadeIn({duration:0.8,concurrent:true,endOpacity:0.9,scope:this,callback:this._doAfterShow.createDelegate(this)});}else{this.el.setVisible(true);this._doAfterShow();}},onDestroy:function(){if(this.rendered){this._removeCloseEl();Ext.destroyMembers(this,"_textEl","_titleEl");}if(this._dismissTimer){window.clearTimeout(this._dismissTimer);}Ext.ux.jnap.NotificationMessage.superclass.onDestroy.call(this);},_getTplArgs:function(){return{cls:this.baseCls,type:this.type,hasTitle:this.title!=null&&this.title.trim()>0,title:this.title,msg:this.msg,closeable:this.closeable};},_doOnHide:function(){if(this._closeElTooTip){this._closeElTooTip.hide();}if(this.destroyOnHide){this.destroy();}},_doAfterShow:function(){if(this.dismissDelay){window.clearTimeout(this._dismissTimer);this._dismissTimer=this.hide.defer(this.dismissDelay,this);}},_configCloseEl:function(){if(this._closeEl){this._closeEl.addClassOnOver(this.baseCls+"-close-hover");this.mon(this._closeEl,"click",function(a,b,c){this.hide();},this);this._closeElTooTip=new Ext.ToolTip({target:this._closeEl,html:this.closeTitle});}},_removeCloseEl:function(){if(this._closeEl){this._closeEl.remove();delete this._closeEl;}if(this._closeElToolTip){this._closeElToolTip.destroy();delete this._closeElToolTip;}}});Ext.reg("notificationmsg",Ext.ux.jnap.NotificationMessage);Ext.ux.jnap.NotificationMessagePlugin=Ext.extend(Object,{defaults:{},targetSelector:"div.{baseCls}-body",width:"98%",positionOffset:[0,-6],constructor:function(a){a=a||{};Ext.apply(this,a);},init:function(a){if(!a instanceof Ext.Container){return false;}this.container=a;this.container.afterRender=this.container.afterRender.createSequence(this.afterRender,this);},afterRender:function(){this._containerEl=this.container.el;if(this.targetSelector){this._containerEl=this.container.el.child(new Ext.Template(this.targetSelector).apply(this.container));}this.container.showNotificationMsg=this.showNotificationMsg.createDelegate(this);},showNotificationMsg:function(b){if(Ext.isString(b)){b={msg:b};}Ext.applyIf(b,this.defaults);var a=false;if(!this.msg){Ext.apply(b,{destroyOnHide:false});this.msg=new Ext.ux.jnap.NotificationMessage(b);a=true;}if(!a){this.msg.update(b);}Ext.ux.jnap.NotificationMgr.notify({msg:this.msg,position:Ext.ux.jnap.NotificationMgr.TARGET_TOP_CENTER,positionOffset:this.positionOffset,target:this._containerEl,width:this.width});}});Ext.preg("notificationmsg",Ext.ux.jnap.NotificationMessagePlugin);Ext.ux.jnap.NotificationMgr=function(){var e=new Ext.util.MixedCollection();var c=function(f){return f.createChild({tag:"div",cls:"x-notification-msg-container"});};var b=null;var d=new Array();var a=true;return{TARGET_TOP_LEFT:"tl-tl",TARGET_TOP_CENTER:"t-t",TARGET_TOP_RIGHT:"tl-tr",TARGET_BOTTOM_LEFT:"bl-bl",TARGET_BOTTOM_CENTER:"b-b",TARGET_BOTTOM_RIGHT:"br-br",notify:function(h){h=h||{};Ext.applyIf(h,{msg:{},width:350,position:Ext.ux.jnap.NotificationMgr.TARGET_TOP_CENTER,positionOffset:[0,0],target:Ext.getBody()});var k=h.position;var i=h.target;i.id=i.id||Ext.id(i);var g=i.id;if(i==Ext.getBody()){g+="-"+h.position;}var f=e.get(g);if(!f){f=h.container||c(i);e.add(g,f);}var j=h.msg;if(!(j instanceof Ext.ux.jnap.NotificationMessage)){Ext.applyIf(j,{xtype:"notificationmsg"});j=Ext.create(j);}f.setWidth(h.width);if(!j.rendered){j.render(f);}if(j.getWidth()&&f.getWidth()<j.getWidth()){f.setWidth(j.getWidth());}j.show();f.anchorTo(i,h.position,h.positionOffset,false,true);return j;},defaultAjaxLoadingMsgText:"Please wait, loading...",defaultAjaxLoadingMsgStyle:"clear",showAjaxLoadingMsg:function(h,f){d.push(h);if(!b){var g=Ext.ux.jnap.NotificationMgr.defaultAjaxLoadingMsgText;b=Ext.ux.jnap.NotificationMgr.notify({msg:{msg:String.format('<p class="{1}">{0}</p>',g,"x-loading"),type:Ext.ux.jnap.NotificationMgr.defaultAjaxLoadingMsgStyle,extraCls:"no-icon",animateOnShow:false,animateOnHide:false},width:200,position:Ext.ux.jnap.NotificationMgr.TARGET_TOP_LEFT});}},hideAjaxLoadingMsg:function(h,f,g){d.remove(h);if(d.length==0&&(b!=null&&b.isVisible())){b.hide();b=null;}},registerDefaultLoadingMsgOnAjax:function(){var f=Ext.ux.jnap.NotificationMgr;Ext.Ajax.on("beforerequest",f.showAjaxLoadingMsg,f);Ext.Ajax.on("requestcomplete",f.hideAjaxLoadingMsg,f);Ext.Ajax.on("requestexception",f.hideAjaxLoadingMsg,f);}};}();Ext.ns("Ext.ux.jnap");Ext.ux.jnap.Rating=Ext.extend(Ext.BoxComponent,{animateOnChange:true,baseCls:"x-rating",minValue:1,maxValue:5,values:undefined,valueSplit:1,userValue:undefined,averageValue:undefined,clearOption:true,clearText:"Clear my rating",clearValue:-1,defaultDisplayValue:"user",switchValueOption:true,rateSpriteCls:"x-rating-star",rateSpriteImg:{url:undefined,width:16,height:16},showHintTip:true,hintTipText:["Very poor","Poor","OK","Very good","Excellent"],initComponent:function(){Ext.ux.jnap.Rating.superclass.initComponent.call(this);this.addEvents("change","clear","switch");},onRender:function(b,a){this.el=a?this.tpl.insertBefore(a,this,true):this.tpl.append(b,this,true);this.el.setVisibilityMode(Ext.Element.DISPLAY);if(this.values){}this.mon(this.el,this.onMouseOver);this.enable=this.enable.createSequence(this._bindEvents);this.disable=this.disable.createSequence(this._unbindEvents);},fillTo:function(){},_bindEvents:function(){},_unbindEvents:function(){}});Ext.ux.jnap.TagCloud=Ext.extend(Ext.DataView,{animated:true,baseCls:"x-tagcloud",fontSizeUnit:"px",headStyle:"cloud",minFontSize:11,maxFontSize:28,occurencesProperty:"occurences",tagLink:"tag/{text}",tagText:"{text}",title:undefined,initComponent:function(){Ext.ux.jnap.TagCloud.superclass.initComponent.call(this);Ext.apply(this,{cls:this.baseCls,itemSelector:"span."+this.baseCls+"-tag",singleSelect:false,multiSelect:false,selectedClass:"",overClass:this.baseCls+"-tag-over"});this.tpl=new Ext.XTemplate('<tpl if="headStyle != \'plain\'"><div class="{baseCls}-header-{headStyle}"></div></tpl>','<div class="{baseCls}-body">','<tpl if="title"><h3>{title}</h3></tpl>','<p class="{baseCls}-tag-list">','<tpl for="tags">','<span class="{parent.baseCls}-tag">','<a href="'+this.tagLink+'">'+this.tagText+"</a>","</span>","</tpl>","</p>","</div>",{compiled:true,disableFormats:true});},collectData:function(a,c){var b=this;Ext.apply(b,{tags:Ext.ux.jnap.TagCloud.superclass.collectData.call(this,a,c)});return b;},refresh:function(){Ext.ux.jnap.TagCloud.superclass.refresh.call(this);this.onRefresh.defer(10,this);},onRefresh:function(){var c=this.store.collect(this.occurencesProperty);var b=Ext.min(c),a=Ext.max(c);Ext.each(this.all.elements,function(g,e,k){var d=this.store.getAt(g.viewIndex);var f=d.get(this.occurencesProperty);var j=(Math.log(f)-Math.log(b))/(Math.log(a)-Math.log(b));var h=this.minFontSize+Math.round((this.maxFontSize-this.minFontSize)*j);this._setTagFontSize(Ext.fly(g).first(),h);},this);},_setTagFontSize:function(a,b){if(this.animated){a.animate({fontSize:{from:this.minFontSize,to:b,unit:this.fontSizeUnit}},0.3,null,"easeOut","run");}else{a.setStyle("fontSize",b+this.fontSizeUnit);}}});Ext.ux.jnap.XBody=new (Ext.extend(Ext.util.Observable,{bodyEl:undefined,_prevSize:{height:0,width:0},constructor:function(){this.bodyEl=Ext.getBody();this.addEvents("change");},fireChangeEvent:function(){var a=this.bodyEl.getSize();if((this._prevSize.height!=a.height)||(this._prevSize.width!=a.width)){this.fireEvent("change",this,this._prevSize.width,this._prevSize.height,a.width,a.height);Ext.apply(this._prevSize,a);}},applyChangeEvents:function(){var e=Ext.Component.prototype;e.onHide=e.onHide.createSequence(this.fireChangeEvent,this);e.onShow=e.onShow.createSequence(this.fireChangeEvent,this);e.onRemoved=e.onRemoved.createSequence(this.fireChangeEvent,this);e.onAdded=e.onAdded.createSequence(this.fireChangeEvent,this);var d=Ext.BoxComponent.prototype;d.onResize=d.onResize.createSequence(this.fireChangeEvent,this);var c=Ext.Container.prototype;c.doLayout=c.doLayout.createSequence(this.fireChangeEvent,this);var b=Ext.Panel.prototype;b.onCollapse=b.onCollapse.createSequence(this.fireChangeEvent,this);b.onExpand=b.onExpand.createSequence(this.fireChangeEvent,this);b.onBodyResize=b.onBodyResize.createSequence(this.fireChangeEvent,this);var a=Ext.ux.jnap.NotificationMessage.prototype;a.onShow=a.onShow.createSequence(this.fireChangeEvent,this);a.onHide=a.onHide.createSequence(this.fireChangeEvent,this);}}))();Ext.ns("Ext.ux.jnap.util");Ext.ux.jnap.util.Conventions=function(){return{autoApply:true,enableNamespaceShortcut:function(){Ext.ns("jnap");jnap=Ext.ux.jnap;},setDefaultDataProperties:function(){Ext.data.JsonReader.prototype.root="modelList";Ext.data.JsonReader.prototype.id="id";Ext.data.JsonReader.prototype.restful=true;},DEFAULT_PAGE_SIZE:15,doAutoLoadWithPaging:function(){return{start:0,limit:Ext.ux.jnap.util.Conventions.DEFAULT_PAGE_SIZE};},setDefaultPagingConfig:function(a){Ext.PagingToolbar.prototype.pageSize=a;Ext.data.JsonReader.prototype.totalProperty='pagingData["totalResults"]';},setDefaultFormConventions:function(){Ext.form.ComboBox.prototype.queryParam="searchQuery";},enableBodyChangedEvents:function(){Ext.ux.jnap.XBody.applyChangeEvents();},applyPlainButtonMarkup:function(){Ext.Button.buttonTemplate=new Ext.Template('<button id="{4}" class="x-btn {1} {2} {3}" type="{0}"></button>',{compiled:true});},applyAll:function(){Ext.QuickTips.init();jnapconv.enableNamespaceShortcut();jnapconv.setDefaultDataProperties();jnapconv.setDefaultPagingConfig(jnapconv.DEFAULT_PAGE_SIZE);jnapconv.enableBodyChangedEvents();jnapconv.applyPlainButtonMarkup();jnap.NotificationMgr.registerDefaultLoadingMsgOnAjax();}};}();jnapconv=Ext.ux.jnap.util.Conventions;(function(){Ext.override(Ext.ToolTip,{initTarget:function(h){var f;if((f=Ext.get(h))){var d=this.showEvents||[];var i=this.hideEvents||[];if(this.target){var g=Ext.get(this.target);if(!this.suppressDefaultEvents){this.mun(g,"mouseover",this.onTargetOver,this);this.mun(g,"mouseout",this.onTargetOut,this);this.mun(g,"mousemove",this.onMouseMove,this);}Ext.each(d,function(k,j,l){this.mun(g,k,this.onTargetOver,this);},this);Ext.each(i,function(k,j,l){this.mun(g,k,this.onTargetOut,this);},this);}var e={scope:this};if(!this.suppressDefaultEvents){Ext.apply(e,{mouseover:this.onTargetOver,mouseout:this.onTargetOut,mousemove:this.onMouseMove});}Ext.each(d,function(k,j,l){e[k]=this.onTargetOver;},this);Ext.each(i,function(k,j,l){e[k]=this.onTargetOut;},this);this.mon(f,e);this.target=f;}if(this.anchor){this.anchorTarget=this.target;}}});Ext.override(Ext.form.Action,{processResponse:function(d){this.response=d;if(!d.responseText&&!d.responseXML){return true;}this.result=this.handleResponse(d);this.result.success=(d.status>=200&&d.status<300);return this.result;}});var c=Ext.grid.GridPanel.prototype.afterRender;Ext.override(Ext.grid.GridPanel,{afterRender:function(){c.call(this);this.mon(this.getGridEl(),"resize",function(){var d=this.getGridEl().getSize();this.fireEvent("bodyresize",this,d.width,d.height);},this);}});var b=Ext.Element.prototype.anchorTo;Ext.override(Ext.Element,{anchorTo:function(g,k,h,d,e,j){var f=b.call(this,g,k,h,d,e,j);var i=this.dom;Ext.ux.jnap.XBody.on("change",function(){Ext.fly(i).alignTo(g,k,h,d);},Ext.ux.jnap.XBody,{buffer:250});return f;}});var a=Ext.ux.jnap.util.Conventions;if(a.autoApply){a.applyAll();}})();Ext.ns("Ext.ux.jnap.util");Ext.ux.jnap.util.ExtUtils=function(){var a=function(c,b){this.getEl().setSize(c,b);};return{wrapField:function(b){if(!b.isFormField){return undefined;}if(!b.wrap){b.wrap=b.getEl().wrap({cls:"x-form-field-wrap"});b.positionEl=b.resizeEl=b.wrap;b.actionMode="wrap";b.onResize=b.onResize.createSequence(a,b);}return b.wrap;},createOverlay:function(d,b){var e=Ext.id(d)+"-overlay";var c=Ext.get(e);if(!c){b=Ext.applyIf(b||{},{style:{position:"absolute",zIndex:20000}});c=Ext.getBody().createChild({id:e,cls:b.cls||"",style:b.style});c.setHeight(d.getHeight());c.setWidth(d.getWidth());c.anchorTo(d,"tl?");d.on("resize",function(g,f,h){f=Ext.get(f);this.setHeight(f.getHeight());this.setWidth(f.getWidth());},c);}return c;},createXhrObject:function(){var f=null;try{f=new XMLHttpRequest();}catch(d){var b=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"];for(var c=0;c<b.length;c++){try{f=new ActiveXObject(b[c]);break;}catch(d){}}}if(!f){throw"[Ext.ux.jnap.util.ExtUtils.createXhrObject] This client has no support for Ajax (XMLHttpRequest).";}return f;},highlightKeyword:function(e,d,c,b){if(e.nodeType!=3){if(b){Ext.each(e.childNodes,function(f){highlight(f,d,c,b);},this);}}else{Ext.fly(e).replaceWith({tag:"span",html:e.nodeValue.replace(new RegExp(d,"gi"),String.format('<span class="{0}">{1}</span>',c,d))});}}};}();Ext.ns("Ext.ux.jnap.data");Ext.ux.jnap.data.JsonErrorReader=Ext.extend(Ext.data.JsonReader,{read:function(a){alert(a);},readRecords:function(a){alert(a);}});Ext.ns("Ext.ux.jnap.data");Ext.ux.jnap.data.XmlErrorReader=Ext.extend(Ext.data.XmlReader,{read:function(a){},readRecords:function(a){}});Ext.ns("Ext.ux.jnap.form");Ext.ux.jnap.form.Autocomplete=Ext.extend(Ext.form.ComboBox,{animateOnItemAdd:false,animateOnItemRemove:false,autoSelect:false,baseCls:"ux-autocomplete",bindItemAddKey:true,blockAlreadyAddedItem:true,defaultItemWidth:200,emptyText:"emptyText",hideTrigger:true,itemContainerMinWidth:undefined,itemShadow:false,itemLayout:"inline",itemMinWidth:150,itemWidth:undefined,itemTpl:"{displayField}",listEmptyText:"listEmptyText",itemCloseTip:"Click to remove item",minChars:1,multiple:false,queryParam:"searchQuery",removedItemsName:undefined,submitOnlyNewItems:false,_currentSelectedRecord:null,_addedItems:new Ext.util.MixedCollection(),initComponent:function(){Ext.ux.jnap.form.Autocomplete.superclass.initComponent.call(this);if(!!this.multiple){this._applyMultipleConfig();this.afterRender=this.afterRender.createSequence(this._bindEvents,this);this.addEvents("beforeitemadd","itemadded","beforeitemremove","itemremoved");if(Ext.isString(this.itemTpl)){this.itemTpl=new Ext.XTemplate(this.itemTpl,{compiled:true});}}},onTriggerClick:function(){if(this._currentSelectedRecord){this.addItem(this._currentSelectedRecord);this.clear();}},addItem:function(a){if(!this.wasAlreadyAdded(a)&&this.fireEvent("beforeitemadd",this,a)!==false){var b=this.onItemAdd(a);this.fireEvent("itemadded",this,a,b);}},onItemAdd:function(a){var b=new Ext.ux.jnap.AutocompleteItem(this,a);this._addedItems.add(b);return b;},clear:function(){this.setValue("");this._currentSelectedRecord=null;},wasAlreadyAdded:function(a){var b=false;if(this.blockAlreadyAddedItem){b=this._addedItems.find(function(c){return c.record.id==a.id;},this)!=null;}return b;},onDestroy:function(){if(this.rendered){}Ext.ux.jnap.form.Autocomplete.superclass.onDestroy.call(this);},_applyMultipleConfig:function(){this.hideTrigger=false;this.triggerClass=this.baseCls+"-add-trigger";},getItemContainer:function(){if(!this._selectedItemsEl){var a=Ext.ux.jnap.util.ExtUtils.wrapField(this);this._selectedItemsEl=a.createChild({tag:"div",cls:this.baseCls+"-multiple-items"});this._selectedItemsEl.addClass(this.itemLayout);if(this.itemShadow){this._selectedItemsEl.addClass("shadow");}if(this.itemContainerMinWidth){a.setWidth(this.itemContainerMinWidth);}this._bindEvents();}return this._selectedItemsEl;},_resetCurrentRecord:function(){this._currentSelectedRecord=null;},_bindEvents:function(){this.mon(this,"select",function(c,a,b){this._currentSelectedRecord=a;},this);this.enableKeyEvents=true;this.mon(this,"specialkey",function(b,a){if(this.bindItemAddKey&&(a.getKey()==a.ENTER)){this.onTriggerClick();}},this);}});Ext.ux.jnap.AutocompleteItem=Ext.extend(Object,{autocomplete:null,id:null,itemEl:null,record:null,removeItemEl:null,constructor:function(b,a){this.autocomplete=b;this.record=a;this.itemEl=this._createItemEl(b.getItemContainer());this.itemEl.setVisible(true,this.getParentCfg("animateOnItemAdd"));},getParentCfg:function(a){return this.autocomplete[a];},remove:function(){this.autocomplete._addedItems.remove(this);if(this.autocomplete.fireEvent("beforeitemremove",this.autocomplete,this)!==false){var a=function(){this.autocomplete.fireEvent("itemremoved",this.autocomplete,this);this.removeItemTooltip.hide();Ext.destroyMembers(this,"itemEl","removeItemEl","removeItemTooltip");};if(this.getParentCfg("animateOnItemRemove")){this.itemEl.setVisible(false,{callback:a.createDelegate(this)});}else{this.itemEl.setVisible(false);a.call(this);}}},getEl:function(){return this.itemEl;},_createItemEl:function(b){var f=this._getTplArgs();var a=this.getParentCfg("baseCls");var e=b.createChild({tag:"div",cls:a+"-multiple-item",style:{display:"none"},children:[{tag:"input",type:"hidden",name:this.getParentCfg("name"),value:f.valueField},{tag:"span",cls:a+"-multiple-item-content",html:this.getParentCfg("itemTpl").apply(f)}]});this.removeItemEl=this._createItemRemoveEl(e);var d=("stack"===this.getParentCfg("itemLayout")&&!this.getParentCfg("itemWidth"))?this.getParentCfg("defaultItemWidth"):null;if(d){e.setWidth(d);}var c=this.getParentCfg("itemMinWidth")||0;if(e.getWidth()<c){e.setWidth(c);}this.id=Ext.id(e);return e;},_createItemRemoveEl:function(b){var a=b.createChild({tag:"span",cls:this.getParentCfg("baseCls")+"-multiple-item-remove"});this.removeItemTooltip=new Ext.ToolTip({target:a,html:this.getParentCfg("itemCloseTip")});this.autocomplete.mon(a,"click",this.remove,this);return a;},_getTplArgs:function(){var a=this.record;var b=Ext.apply({},a.data);Ext.apply(b,{id:a.id,displayField:a.get(this.getParentCfg("displayField")),valueField:a.get(this.getParentCfg("valueField"))});return b;}});Ext.ns("Ext.ux.jnap.form");Ext.ux.jnap.form.ChainedComboBoxPlugin=Ext.extend(Object,{comboRef:null,paramName:null,constructor:function(a){a=a||{};Ext.apply(this,a);},init:function(a){if(!this.comboRef){throw"The parent combo reference cannot be null";}this._otherCombo=Ext.isString(this.comboRef)?Ext.getCmp(this.comboRef):this.comboRef;if(!(this._otherCombo instanceof Ext.form.ComboBox)){throw'The parent combo must be of type "Ext.form.ComboBox" or subclasses of it.';}a.disable();this._combo=a;this._otherCombo.mon(this._otherCombo,"select",this._onValueUpdate,this);this._otherCombo.mon(this._otherCombo,"change",this._onValueUpdate,this);this._otherCombo.mon(this._otherCombo,"disable",this._onDisable,this);},_onValueUpdate:function(c,b){var a=this._combo;if(a.disabled&&b){a.enable();}this._resetCombo(a);if(!b){a.disable();}a.getStore().setBaseParam(this.paramName||c.hiddenName||c.name,c.getValue());},_onDisable:function(b){var a=this._combo;this._resetCombo(a);a.disable();},_resetCombo:function(b){var a=b.getValue();b.clearValue();b.lastQuery=null;b.getStore().removeAll();b.fireEvent("change",b,null,a);}});Ext.ns("Ext.ux.jnap.form");Ext.ux.jnap.form.CharactersLimitPlugin=Ext.extend(Object,{text:"You have <strong>{0}</strong> characters remaining",baseCls:"x-field-charlimit-hint",crop:false,constructor:function(a){a=a||{};Ext.apply(this,a);},init:function(a){if(!(a instanceof Ext.form.TextArea)||!a.maxLength){return false;}this.textarea=a;Ext.apply(a,{enableKeyEvents:true});a.afterRender=a.afterRender.createSequence(this.afterRender,this);},afterRender:function(){var a=this.textarea;if(this.text){Ext.ux.jnap.util.ExtUtils.wrapField(a);this.charsLeftEl=a.wrap.createChild({tag:"div",cls:this.baseCls});}this.handleCharLimit();this._bindListeners();},handleCharLimit:function(){var d=this.textarea;var a=d.maxLength;var b=d.getValue();var c=0;if(b){c=b.length;}if(c>a&&this.crop){d.setValue(b.substring(0,a));c=a;}if(this.text){this.charsLeftEl.update(String.format(this.text,(a-c)));}},_bindListeners:function(){Ext.each(["keydown","paste","input"],function(b,a,c){this.textarea.mon(this.textarea.el,b,this.handleCharLimit,this,{buffer:100});},this);}});Ext.preg("charlimit",Ext.ux.jnap.form.CharactersLimitPlugin);Ext.ns("Ext.ux.jnap.form");Ext.ux.jnap.form.ClearFieldPlugin=Ext.extend(Object,{baseCls:"x-field-clear",clearValue:"",clearTip:"Click to clear the field",animateOnShow:true,animateOnHide:true,constructor:function(a){a=a||{};Ext.apply(this,a);},init:function(a){if(!a instanceof Ext.form.Field){return false;}this.field=a;a.afterRender=a.afterRender.createSequence(this.afterRender,this);},afterRender:function(){this._createClearTrigger();this.field.mon(this.field.el,"mouseover",this.onMouseOver,this,{buffer:20});this.field.mon(this.field.el,"mouseout",this.onMouseOut,this,{buffer:20});this.field.mon(this.field,"afterrender",this._doTriggerPosition,this);this.field.mon(this.field,"destroy",this.onDestroy,this);},onMouseOver:function(){if(!this._triggerEl.isVisible()){if(this.animateOnShow){this._triggerEl.fadeIn({endOpacity:0.65,duration:0.2});}else{this._triggerEl.show();}}},onMouseOut:function(){if(!this._triggerEl.hasClass(this.baseCls+"-over")){if(this.animateOnHide){this._triggerEl.fadeOut({duration:0.2});}else{this._triggerEl.hide();}this._triggerTip.hide();}},onDestroy:function(){Ext.destroyMembers(this,"_triggerEl","_triggerTip");},onClick:function(){this.field.setValue(this.clearValue);this.field.focus();},_createClearTrigger:function(){this._triggerEl=this.field.el.parent().createChild({tag:"span",cls:this.baseCls},this.field.el);this._triggerEl.addClassOnOver(this.baseCls+"-over");this._triggerEl.setVisibilityMode(Ext.Element.VISIBILITY);this.field.mon(this._triggerEl,"click",this.onClick,this);this._doTriggerPosition();this._triggerTip=new Ext.ToolTip({target:this._triggerEl,html:this.clearTip});},_doTriggerPosition:function(){this._triggerEl.setStyle("zIndex",this.field.el.getStyle("zIndex")+1);this._triggerEl.anchorTo(this.field.el,"t-tr",[-10,3]);}});Ext.preg("clearfield",Ext.ux.jnap.form.ClearFieldPlugin);Ext.ns("Ext.ux.jnap.form");Ext.ux.jnap.form.FieldHintTargetRenderer={bottom:{renderHint:function(c){var d=c._field;var a=Ext.ux.jnap.util.ExtUtils.wrapField(d);if(a){var b=a.createChild({cls:c.baseCls,html:d.getHintText()});d.hintEl=b;}},clearHint:function(a){}}};Ext.ux.jnap.form.FieldHintPlugin=Ext.extend(Object,{hintText:"",baseCls:"x-field-hint",hintTarget:"bottom",_field:undefined,constructor:function(a){Ext.apply(this,a||{});},init:function(a){if(!a.isFormField){return false;}this._renderer=Ext.ux.jnap.form.FieldHintTargetRenderer[this.hintTarget];if(!this._renderer){return false;}this._field=a;Ext.apply(this._field,{getHintText:this.getHintText.createDelegate(this),getHintCls:null,setHintText:null,removeHint:null,showHint:null,hideHint:null});this._hintTpl=new Ext.Template(this.hintText,{compiled:true});this._refreshHintText();a.afterRender=a.afterRender.createSequence(this.afterRender,this);},afterRender:function(){this._renderer.renderHint(this);},getHintText:function(){return this._hintMsg;},_refreshHintText:function(){this._hintTpl.set(this.hintText,true);this._hintMsg=this._hintTpl.apply(this._field);}});Ext.ux.jnap.form.FormUtils=function(){var a=function(b){var c=undefined;switch(b.failureType){case Ext.form.Action.CLIENT_INVALID:c={type:"warning",msg:Ext.ux.jnap.form.FormUtils.defaultInvalidMsg};break;case Ext.form.Action.CONNECT_FAILURE:c={type:"error",msg:Ext.ux.jnap.form.FormUtils.defaultErrorMsg};break;default:c={type:"error",msg:b.result.msg,dismissDelay:0};}return c;};return{defaultSuccessMsg:"Your data has been successfully submitted.",defaultInvalidMsg:"Your form contains invalid data, correct it and try again.",defaultErrorMsg:"There was a server communication error while processing your form.",defaultResetOnSuccess:false,defaultClearOnSuccess:false,defaultSubmitMethod:"POST",restfulMethodParamName:"_http_method",formMessageDefaults:{closeable:true,dismissDelay:5000,destroyOnHide:true},submit:function(i,c,g){g=g||{};Ext.applyIf(g,{clearOnSuccess:Ext.ux.jnap.form.FormUtils.defaultClearOnSuccess,errorMsg:a,invalidMsg:Ext.ux.jnap.form.FormUtils.defaultInvalidMsg,resetOnSuccess:Ext.ux.jnap.form.FormUtils.defaultResetOnSuccess,msgTarget:Ext.getBody(),onSuccess:Ext.emptyFn,onError:Ext.emptyFn,successMsg:Ext.ux.jnap.form.FormUtils.defaultSuccessMsg});var b=g.form||i.findParentByType(Ext.form.FormPanel);if(b.submitConfig){Ext.apply(g,b.submitConfig);}if(!b){throw String.format("[FormUtils.submit] The button {0} is not inside a form.",i.id);}var f=b.getForm();if(f.isValid()){var d=g.method||f.method||b.method;if(!d){d=Ext.ux.jnap.form.FormUtils.defaultSubmitMethod;}d=d.toUpperCase();var h={};if(d!="GET"&&d!="POST"){b.add({xtype:"hidden",name:Ext.ux.jnap.form.FormUtils.restfulMethodParamName,value:d});b.doLayout();h["X-HTTP-Method-Override"]=d;d="POST";}i.disable();f.submit({url:g.url||f.url||b.url,method:d,headers:h,success:function(k,j){i.enable();g.onSuccess.call(k,k,j);if(g.resetOnSuccess){k.reset();}if(g.clearOnSuccess){}Ext.ux.jnap.form.FormUtils.showMessage(b,{msg:g.successMsg,type:"success"},g.msgTarget);},failure:function(l,j){i.enable();g.onError.call(l,l,j);var k=Ext.isFunction(g.errorMsg)?g.errorMsg.call(l,j):g.errorMsg;Ext.ux.jnap.form.FormUtils.showMessage(b,k,g.msgTarget);}});}else{Ext.ux.jnap.form.FormUtils.showMessage(b,{msg:Ext.ux.jnap.form.FormUtils.defaultInvalidMsg,type:"warning"},g.msgTarget);var e=b.findBy(function(j){return j.isFormField&&j.isValid&&!j.isValid(false);});e[0].focus();}},showMessage:function(b,h,f){Ext.applyIf(h,Ext.ux.jnap.form.FormUtils.formMessageDefaults);var c=b.showNotificationMsg?b:undefined;if(!c){var c=b.findParentBy(function(i,j){return i.showNotificationMsg!=undefined;});}if(c){c.showNotificationMsg(h);}else{if(f){Ext.ux.jnap.NotificationMgr.notify({msg:h,target:f});}else{var g=b.getId()+"-messages";var e=Ext.get(g)||Ext.getCmp(g);if(!e){b.insert(0,new Ext.BoxComponent({id:g}));b.doLayout();}var d=new Ext.ux.jnap.NotificationMessage(h);d.render(g);}}}};}();Ext.applyIf(Ext.form.MessageTargets,{"field-icon-tip":{defaultErrorTipAnchor:"left",mark:function(d,e){d.el.addClass(d.invalidClass);if(!d.errorIcon){var c=d.getErrorCt();if(!c){d.el.dom.title=e;return;}d.errorIcon=c.createChild({cls:"x-form-invalid-icon"});if(d.ownerCt){d.mon(d.ownerCt,"afterlayout",d.alignErrorIcon,d);d.mon(d.ownerCt,"expand",d.alignErrorIcon,d);}var b={top:[-11,1],left:[0,0],bottom:[-11,5],right:[2,0]};var a=d.errorTipAnchor||this.defaultErrorTipAnchor;d.errorTip=new Ext.ToolTip({html:e,target:d.errorIcon,showDelay:100,autoHide:false,minWidth:120,maxWidth:280,anchor:a,mouseOffset:b[a]});d.mon(d,"focus",function(){if(!this.errorTip.isVisible()&&this.el.hasClass(this.invalidClass)){this.errorTip.show();}},d);d.mon(d,"blur",function(){if(!this.errorIconMouseOver){this.errorTip.hide();}},d);d.mon(d.errorIcon,"mouseover",function(){this.errorIconMouseOver=true;},d);d.mon(d.errorIcon,"mouseout",function(){this.errorIconMouseOver=false;if(!this.el.hasClass(this.focusClass)){this.errorTip.hide();}},d);d.mon(d,"resize",d.alignErrorIcon,d);d.mon(d,"destroy",function(){Ext.destroy(this.errorIcon,this.errorTip);},d);}d.alignErrorIcon();d.errorIcon.show();if(d.errorTip&&d.errorTip.rendered){d.errorTip.update(e);}if(d.el.hasClass(d.focusClass)){d.errorTip.show();}},clear:function(a){if(a.errorIcon){a.errorIcon.dom.qtip="";a.errorIcon.hide();a.errorTip.hide();}a.el.removeClass(a.invalidClass);}}});Ext.ns("Ext.ux.jnap.form");Ext.ux.jnap.form.PasswordFieldPlugin=Ext.extend(Object,{capsLockTip:"Caps Lock is <strong>on</strong>. Since passwords are case sensitive, this may cause you to enter it incorrectly.",showCapsLockTip:true,minLength:6,maxLength:14,validKeysRegExp:/^([a-zA-Z0-9@#])$/,keyFiltering:false,lengthLimit:false,_field:undefined,constructor:function(a){Ext.apply(this,a||{});},init:function(a){if(!(a instanceof Ext.form.TextField)){return false;}this._field=a;a.inputType="password";if(this.lengthLimit){a.minLength=this.minLength;a.maxLength=this.maxLength;}if(this.keyFiltering){a.maskRe=this.validKeysRegExp;}if(this.showCapsLockTip){a.enableKeyEvents=true;a.afterRender=a.afterRender.createSequence(this.handleCapsLockKey,this);}},handleCapsLockKey:function(){this._field.mon(this._field.el,"keypress",function(a,b){if(this._isCapsLockOn(a)){if(!this._capsLockTip){this._capsLockTip=new Ext.ToolTip({anchor:"top",dismissDelay:4000,hidden:true,html:this.capsLockTip,maxWidth:300,suppressDefaultEvents:true,target:this._field.el});}this._capsLockTip.show();}else{if(this._capsLockTip&&this._capsLockTip.isVisible()){this._capsLockTip.hide();}}},this,{buffer:100});},_isCapsLockOn:function(b){var a=b.getCharCode();var c=b.shiftKey;return(a>=97&&a<=122&&c)||(a>=65&&a<=90&&!c);}});Ext.ns("Ext.ux.jnap.form");Ext.ux.jnap.form.RequiredFieldsPlugin=Ext.extend(Object,{mark:"<span class='{0}'>*</span>",markPosition:"right",markCls:"x-field-required",showHint:true,hintText:"Fields marked with {0} are required",hintTarget:undefined,hintTextCls:"x-field-required-hint",constructor:function(a){a=a||{};Ext.apply(this,a);},init:function(e){if(!e instanceof Ext.form.FormPanel){return false;}var a=false;var b=String.format(this.mark,this.markCls);var d=this.markPosition;Ext.each(e.find(),function(g){if(g.allowBlank===false){if(d=="left"){g.fieldLabel=b+g.fieldLabel;}else{g.fieldLabel=g.fieldLabel+b;}a=true;}});if(a&&this.showHint){var c=String.format(this.hintText,b);if(this.hintTarget){var f=this.hintTarget;if(Ext.isString(this.hintTarget)){f=Ext.get(this.hintTarget);if(!f){f=Ext.getCmp(this.hintTarget);}}if(f&&f.addClass&&f.update){f.addClass(this.hintTextCls);f.update(c);}}else{e.add({xtype:"box",autoEl:{tag:"div",cls:this.hintTextCls},html:c});}}return true;}});Ext.preg("requiredfields",Ext.ux.jnap.form.RequiredFieldsPlugin);Ext.ns("Ext.ux.jnap.form");Ext.ux.jnap.form.TextCaseTransform={upper:{style:"uppercase",changeCase:function(a){return a?a.toUpperCase():a;}},lower:{style:"lowercase",changeCase:function(a){return a?a.toLowerCase():a;}}};Ext.ux.jnap.form.TextCasePlugin=Ext.extend(Object,{mode:"upper",field:undefined,constructor:function(a){a=a||{};Ext.apply(this,a);},init:function(a){if(!a.isFormField){return false;}this.field=a;a.afterRender=a.afterRender.createSequence(this.afterRender,this);},afterRender:function(){var b=Ext.ux.jnap.form.TextCaseTransform[this.mode];var a=this.field;if(b.style){a.getEl().applyStyles({textTransform:b.style});}a.mon(a.getEl(),"blur",function(c,e,d){this.setValue(b.changeCase(this.getValue()));},a);}});Ext.ns("Ext.ux.jnap.upload");Ext.ux.jnap.upload.UploadProvider=Ext.extend(Ext.util.Observable,{alias:undefined,uploader:undefined,constructor:function(a){Ext.apply(this,a||{});this.addEvents("initsuccess","initerror");},init:function(a){this.uploader=a;},getFeatures:function(){return{chunks:false,dnd:false,multipart:false,progress:false};},upload:function(a){if(a.getStatus()==Ext.ux.jnap.upload.UploadStatus.QUEUED&&this.uploader.fireEvent("beforeuploadstart",a)!==false){a.setStatus(Ext.ux.jnap.upload.UploadStatus.UPLOADING);this.uploader.fireEvent("uploadstart",this.uploader,this,a);this.onUpload.call(this,a);}},cancel:function(a){if(this.uploader.fireEvent("beforeuploadcancel",a)!==false){if(Ext.ux.jnap.upload.UploadStatus.UPLOADING==a.getStatus()){this.onCancel.call(this,a);}a.setStatus(Ext.ux.jnap.upload.UploadStatus.CANCELLED);this.uploader.fireEvent("uploadcancel",this.uploader,this,a);this.uploader.fireEvent("uploadfinish",this.uploader,this,a,299,null);}},bindTriggerEvents:function(a){a.on({scope:this,mouseenter:function(d,c,b){this.uploader.fireEvent("browsefilesover",d,c);},mouseleave:function(d,c,b){this.uploader.fireEvent("browsefilesout",d,c);},click:function(d,c,b){this.uploader.fireEvent("browsefilesclick",d,c);}});},onCancel:function(a){},onUpload:function(a){},toUploadFile:function(a){}});Ext.ns("Ext.ux.jnap.upload");Ext.ux.jnap.upload.Uploader=Ext.extend(Ext.util.Observable,{providers:undefined,autoStart:true,baseCls:"ux-upload",batchSize:1,browseFilesTriggerEl:null,dropContainerEl:null,dropHintText:"Drop files here",fileNameParam:"upload[]",multiple:true,maxQueueSize:0,requiredFeatures:["multipart"],url:undefined,activeProvider:undefined,queue:undefined,constructor:function(b){var a=this;Ext.apply(a,b||{});var h=Ext.ux.jnap.upload;a.addEvents("beforefileadd","beforefileremove","beforeuploadstart","beforeuploadcancel","browsefilesclick","browsefilesover","browsefilesout","fileadded","fileremoved","initerror","initsuccess","queuechanged","uploadcancel","uploadfinish","uploaderror","uploadprogress","uploadstart","uploadsuccess");a.providers=a.providers||[new h.Html5Provider(),new h.FlashProvider(),new h.StandardProvider()];var e=null;for(var d=0;d<a.providers.length;d++){e=a.providers[d];var g=e.init(a);if(g){var f=e.getFeatures();var c=Ext.partition(a.requiredFeatures||[],function(i){return f[i];});if(c[1].length===0){a.activeProvider=e;break;}}}if(!a.activeProvider){a.fireEvent("initerror",a);}else{a.queue=new h.UploadQueue(a);a._bindDefaultEvents();a.fireEvent("initsuccess",a,a.activeProvider);}},start:function(a){this.activeProvider.upload(Ext.isString(a)?this.queue.getFile(a):a);},cancel:function(a){this.activeProvider.cancel(Ext.isString(a)?this.queue.getFile(a):a);},_onFileAdd:function(c,a,b){if(this.autoStart&&(a.getUploadingCount()<this.batchSize)){this.start(b);}},_onUploadFinish:function(c,d,b){var a=this.queue;if(this.autoStart&&(a.getUploadingCount()<this.batchSize&&a.isPending())){this.start(a.getNextInQueue());}},_onUploadSuccess:function(c,d,b,a){b.setStatus(Ext.ux.jnap.upload.UploadStatus.DONE);},_onUploadError:function(c,d,b,a){b.setStatus(Ext.ux.jnap.upload.UploadStatus.FAILED);},_bindDefaultEvents:function(){this.on("fileadded",this._onFileAdd,this);this.on("uploadsuccess",this._onUploadSuccess,this);this.on("uploaderror",this._onUploadError,this);this.on("uploadfinish",this._onUploadFinish,this);},destroy:function(){}});Ext.ux.jnap.upload.UploadStatus={QUEUED:1,UPLOADING:2,FAILED:3,DONE:4,CANCELLED:5};Ext.ux.jnap.upload.UploadQueue=Ext.extend(Object,{constructor:function(a){Ext.ux.jnap.upload.UploadQueue.superclass.constructor.call();this.uploader=a;this.files=new Ext.util.MixedCollection(false,function(b){return b.getId();});},files:new Ext.util.MixedCollection(),uploader:undefined,addFile:function(b){var a=this;if(a.uploader.fireEvent("beforefileadd",a.uploader,a,b)!==false){a.files.add(b);a.uploader.fireEvent("fileadded",a.uploader,a,b);a.uploader.fireEvent("queuechanged",a.uploader,a,b);}},removeFile:function(b){var a=this;if(a.uploader.fireEvent("beforefileremove",a.uploader,a,b)!==false){a.files.remove(b);a.uploader.fireEvent("fileremoved",a.uploader,a,b);a.uploader.fireEvent("queuechanged",a.uploader,a,b);}},contains:function(a){return this.files.contains(a);},clear:function(){var a=this;var b=a.files;b.each(function(d,c,e){a.removeFile(d);});},countByStatus:function(a){return this.files.filter("status",a).length;},isEmpty:function(){return !this.files||this.files.getCount()==0;},getFile:function(a){return this.file.get(a);},getLength:function(){return this.files.length;},getTotalSize:function(){var a=0;this.files.each(function(c,b,d){a+=c.getSize();});return a;},getFormattedTotalSize:function(){return Ext.util.Format.fileSize(this.getTotalSize());},getNextInQueue:function(){return this.files.find(function(a){return a.getStatus()==Ext.ux.jnap.upload.UploadStatus.QUEUED;});},isDone:function(){var a=this.files.find(function(b){return b.getStatus()!=Ext.ux.jnap.upload.UploadStatus.DONE;});return a==null;},hasErrors:function(){var a=Ext.partition(this.files,function(b){return b.getStatus()===Ext.ux.jnap.upload.UploadStatus.FAILED;});return a[0].length>0;},getUploadingCount:function(){return this.files.filterBy(function(a){return a.getStatus()===Ext.ux.jnap.upload.UploadStatus.UPLOADING;},this).getCount();},isUploading:function(){return this.files.find(function(a){return a.getStatus()===Ext.ux.jnap.upload.UploadStatus.UPLOADING;},this)!=null;},isPending:function(){return this.files.find(function(a){return a.getStatus()===Ext.ux.jnap.upload.UploadStatus.QUEUED;},this)!=null;}});Ext.ux.jnap.upload.UploadFile=Ext.extend(Object,{nativeRef:undefined,constructor:function(d,b,c,a){this.id=d;this.name=b;this.size=c;this.status=Ext.ux.jnap.upload.UploadStatus.QUEUED;this.nativeRef=a;},getId:function(){return this.id;},getName:function(){return this.name;},getExtension:function(){var a=this.name;var b=undefined;if(a&&a.lastIndexOf(".")!=-1){b=a.substring(a.lastIndexOf("."));}return b;},getSize:function(){return this.size;},getFormattedSize:function(){return this.size?Ext.util.Format.fileSize(this.size):"Unknown";},getStatus:function(){return this.status;},setStatus:function(a){this.status=a;}});Ext.ns("Ext.ux.jnap.upload");Ext.ux.jnap.upload.FlashProvider=Ext.extend(Ext.ux.jnap.upload.UploadProvider,{alias:"flash",baseDir:"/jnap-showcase/swfupload/",flashSrc:"swfupload.swf",jsSrc:"swfupload.js",_swfupload:undefined,_filesMap:new Ext.util.MixedCollection(),getFeatures:function(){return Ext.apply(Ext.ux.jnap.upload.FlashProvider.superclass.getFeatures.call(),{chunks:false,dnd:false,multipart:true,progress:true});},init:function(b){Ext.ux.jnap.upload.FlashProvider.superclass.init.call(this,b);try{this._loadScript();this._initSWFUpload();return true;}catch(a){return false;}},_loadScript:function(){if(!this._isSwfUploadDefined()){var a=Ext.ux.jnap.util.ExtUtils.createXhrObject();a.open("GET",this.baseDir+this.jsSrc,false);a.send("");if(a.status==200&&a.responseText){Ext.getHead().createChild({tag:"script",type:"text/javascript",html:a.responseText});}a=null;delete a;}},_initSWFUpload:function(){if(this._isSwfUploadDefined()){this.browseFilesTriggerEl=Ext.ux.jnap.util.ExtUtils.createOverlay(Ext.get(this.uploader.browseFilesTriggerEl));this.bindTriggerEvents(this.browseFilesTriggerEl);this._swfupload=new SWFUpload({debug:false,flash_url:this.baseDir+this.flashSrc,upload_url:this.uploader.url,file_types:this.uploader.acceptedTypes||[],file_queue_limit:this.uploader.maxQueueSize,button_placeholder:this.browseFilesTriggerEl.createChild().dom,button_height:this.browseFilesTriggerEl.getHeight(),button_width:this.browseFilesTriggerEl.getWidth(),button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,file_post_name:this.uploader.fileNameParam,file_queued_handler:this._onFileQueued.createDelegate(this),upload_error_handler:this._onUploadError.createDelegate(this),upload_progress_handler:this._onUploadProgress.createDelegate(this),upload_success_handler:this._onUploadSuccess.createDelegate(this),minimum_flash_version:"9.0.28"});}else{throw String.format('[Ext.ux.jnap.upload.FlashProvider] The "SWFUpload" object is not available. Make sure you have the swfupload script at the right location: "{0}"',(this.baseDir+this.jsSrc));}},_isSwfUploadDefined:function(){try{return Ext.isFunction(SWFUpload);}catch(a){return false;}},onUpload:function(a){this._swfupload.startUpload(a.nativeRef.id);},onCancel:function(a){this._swfupload.cancelUpload(a.nativeRef.id);},toUploadFile:function(a){return new Ext.ux.jnap.upload.UploadFile(Ext.id(a.name),a.name,a.size,a);},_onFileQueued:function(b){var a=this.toUploadFile(b);this.uploader.queue.addFile(a);this._filesMap.add(b.id,a);},_onUploadProgress:function(c,b,a){this.uploader.fireEvent("uploadprogress",this.uploader,this,this._filesMap.get(c.id),b,(b/a),a);},_onUploadSuccess:function(c,a,b){this.uploader.fireEvent("uploadsuccess",this.uploader,this,this._filesMap.get(c.id),a);this._onUploadComplete(c,200,a);},_onUploadError:function(d,b,c){var a={};this.uploader.fireEvent("uploaderror",this.uploader,this,this._filesMap.get(d.id),a);this._onUploadComplete(d,400,a);},_onUploadComplete:function(d,c,a){var b=this._filesMap.removeKey(d.id);this.uploader.fireEvent("uploadfinish",this.uploader,this,b,c,a);}});Ext.ux.jnap.upload.Html5Provider=Ext.extend(Ext.ux.jnap.upload.UploadProvider,{alias:"html5",dropElement:undefined,requestPool:new Ext.util.MixedCollection(),requestConfig:{contentTypeHeader:"text/plain; charset=x-user-defined-binary",fileNameHeader:"X-File-Name"},init:function(b){Ext.ux.jnap.upload.Html5Provider.superclass.init.call(this,b);var c=Ext.ux.jnap.util.ExtUtils.createXhrObject();var a=!!(c.upload||c.sendAsBinary);if(a){this._loadFeatures(c);if(this.uploader.dropContainerEl&&this.getFeatures().dnd){this._configDropContainer();}}c=null;delete c;this._createInputOverlay.defer(100,this);return a;},getFeatures:function(){return this._features;},_loadFeatures:function(b){var a=!!File;this._features=Ext.ux.jnap.upload.Html5Provider.superclass.getFeatures.call(this);Ext.apply(this._features,{chunks:false,dnd:!!(a&&File.prototype.slice)||window.mozInnerScreenX!==undefined,multipart:!!(a&&File.prototype.getAsDataURL),progress:!!b.upload});},onUpload:function(a){var b=new Ext.ux.jnap.upload.Xhr2Upload(Ext.apply(this.requestConfig||{},{url:this.uploader.url,fileNameParam:this.uploader.fileNameParam}));b.on("uploadprogress",function(c){this.uploader.fireEvent("uploadprogress",this.uploader,this,a,c.loaded,(c.loaded/c.total),c.total);},this);b.on("load",function(e){var f=b.xhr;var c=f.status;var d=f.responseText||f.responseXml;if(c>=200&&c<300){this.uploader.fireEvent("uploadsuccess",this.uploader,this,a,d);}else{this.uploader.fireEvent("uploaderror",this.uploader,this,a,d);}this.uploader.fireEvent("uploadfinish",this.uploader,this,a,c,d);},this);this.requestPool.add(a.getId(),b);b.upload(a.nativeRef);},onCancel:function(c){var b=this.requestPool;var a=c.getId();if(b.containsKey(a)){var d=b.get(a);d.abort();b.removeKey(a);d=null;delete d;}},toUploadFile:function(a){return new Ext.ux.jnap.upload.UploadFile(Ext.id(a.name),a.name,a.fileSize||a.size,a);},_createInputOverlay:function(){var c=this.uploader.browseFilesTriggerEl;var b=this._fileInputOverlay=Ext.ux.jnap.util.ExtUtils.createOverlay(c,{cls:this.uploader.baseCls+"-wrap"});var a=this._fileInput=b.createChild({tag:"input",type:"file",cls:this.uploader.baseCls+"-input-file",multiple:!!this.uploader.multiple,size:1});a.setOpacity(0);a.on("change",function(d,e){this._addSelectedFiles(e.files||[]);},this);this.bindTriggerEvents(b);},_addSelectedFiles:function(b){for(var a=0;a<b.length;a++){this.uploader.queue.addFile(this.toUploadFile(b[a]));}},_resizeDropContainer:function(b){var a=this.dropElement.getMargins();this.dropElement.setSize(b.getWidth()-(a.left+a.right),b.getHeight()-(a.top+a.bottom));},_configDropContainer:function(){var c=Ext.get(this.uploader.dropContainerEl);var b=this.dropElement=c.createChild({cls:this.uploader.baseCls+"-drop-container",html:String.format("<p>{0}</p>",this.uploader.dropHintText)});b.setVisibilityMode(Ext.Element.VISIBILITY);this._resizeDropContainer(c);c.on("resize",function(e,d,f){this._resizeDropContainer(Ext.get(d));},this);var a=Ext.getBody();a.on("dragenter",function(d){this.dropElement.setVisible(true);},this);a.on("dragleave",function(d){this.dropElement.setVisible(false);},this);b.on("dragover",function(d){d.browserEvent.dataTransfer.dropEffect="move";d.preventDefault();},this);b.on("drop",function(d){d.preventDefault();this._addSelectedFiles(d.browserEvent.dataTransfer.files||[]);this.dropElement.setVisible(false);},this);}});Ext.ux.jnap.upload.Xhr2Upload=Ext.extend(Ext.util.Observable,{contentTypeHeader:"text/plain; charset=x-user-defined-binary",fileNameHeader:"X-File-Name",fileNameParam:"fileName",sendMultiPartFormData:false,xhr:undefined,url:"upload/",fileReader:undefined,constructor:function(a){Ext.apply(this,a||{});this.addEvents("load","loadstart","loadend","error","progress","progressabort");},upload:function(a){this.xhr=Ext.ux.jnap.util.ExtUtils.createXhrObject();this._bindEvents();this.xhr.open("post",this.url,true);this.file=a;return this[Ext.isDefined(FileReader)?"_sendFileUsingReader":"_sendBinary"].call(this);},abort:function(){this.xhr.abort();},_sendBinary:function(){this.xhr.overrideMimeType(this.contentTypeHeader);this.xhr.setRequestHeader(this.fileNameHeader,this.file.name);this.xhr.send(this.file);return true;},_sendFileUsingReader:function(){this.fileReader=new FileReader();this.fileReader.readAsBinaryString(this.file);this.fileReader.onload=this._sendMultipartRequest.createDelegate(this);return true;},_sendMultipartRequest:function(){var b="\r\n",c="jnap-ui-html5-upload-"+new Date().getTime(),a="";a+=String.format('--{0}{1}Content-Disposition: form-data; name="{2}"; filename="{3}"{1}Content-Type:{4}{1}Content-Transfer-Encoding: base64{1}{1}{5}{1}--{0}--{1}{1}',c,b,this.fileNameParam,this.file.name,this.file.type,window.btoa(this.fileReader.result));this.xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+c);this.xhr.send(a);},_readBinaryFile:function(){return this.file.getAsBinary?this.file.getAsBinary():window.btoa(this.fileReader.result);},_bindEvents:function(){Ext.each(["loadstart","load","loadend","progress","progressabort","error"],function(a,b,c){this.xhr.addEventListener(a,this._delegateEvent.createDelegate(this),false);this.xhr.upload.addEventListener(a,this._delegateUploadEvent.createDelegate(this),false);},this);},_delegateEvent:function(a){this.fireEvent(a.type,a);},_delegateUploadEvent:function(a){this.fireEvent("upload"+a.type,a);}});Ext.ux.jnap.upload.StandardProvider=Ext.extend(Ext.ux.jnap.upload.UploadProvider,{alias:"standard"});Ext.ns("Ext.ux.jnap.upload");Ext.ux.jnap.upload.UploadPanel=Ext.extend(Ext.Panel,{autoStart:true,browseButtonText:["Add files...","Choose file"],cancelUploadsButtonText:"Cancel file(s)",filesStatusText:["No files yet","Uploaded {0} of {1} files"],uploaderStatusText:["Pending","Uploading","Error","Done","Cancelled"],fileListHeader:{fileName:"Name",fileSize:"Size",fileProgress:"Progress",fileStatus:"Status"},maxQueueSize:0,multiple:true,uploadCls:"ux-upload",url:null,uploader:null,initComponent:function(){this._layoutComponents();Ext.ux.jnap.upload.UploadPanel.superclass.initComponent.call(this);this.afterRender=this.afterRender.createSequence(this._initUploader,this);},getUploader:function(){return this.uploader;},getFileStatusMessage:function(a){var b=this.uploaderStatusText[a.get("status")-1];if(a.get("message")){b=b+": "+a.get("message");}return b;},_layoutComponents:function(){this.layout="fit";this.browseFilesButton=new Ext.Button({text:this.multiple?this.browseButtonText[0]:this.browseButtonText[1],iconCls:this.uploadCls+"-add-files-icon"});this.cancelUploadsButton=new Ext.Button({text:this.cancelUploadsButtonText,disabled:true,iconCls:this.uploadCls+"-cancel-files-icon"});this.tbar=[this.browseFilesButton,"-",this.cancelUploadsButton];this.UploadFile=Ext.data.Record.create(["id","name","size","percentage","status","message"]);this.fileStore=new Ext.data.ArrayStore({idIndex:0,data:[],fields:this.UploadFile,storeId:this.id+"-file-store"});this.filesGrid=new Ext.grid.GridPanel({autoExpandColumn:"name",border:false,store:this.fileStore,colModel:new Ext.grid.ColumnModel({defaults:{sortable:false,resizable:true,menuDisabled:true},columns:[{dataIndex:"name",header:this.fileListHeader.fileName,id:"name"},{align:"right",dataIndex:"size",header:this.fileListHeader.fileSize,renderer:function(a){return Ext.util.Format.fileSize(a);},width:80},{dataIndex:"progress",header:this.fileListHeader.fileProgress,renderer:this._fileProgressColumnRenderer.createDelegate(this),width:140},{align:"center",dataIndex:"status",header:this.fileListHeader.fileStatus,renderer:this._fileStatusColumnRenderer.createDelegate(this),resizable:false,width:60}]})});this.items=[this.filesGrid];this.filesStatusTextItem=new Ext.Toolbar.TextItem(this.filesStatusText[0]);this.bbar=[this.filesStatusTextItem,"-"];},_initUploader:function(){this.uploader=new Ext.ux.jnap.upload.Uploader({autoStart:this.autoStart,baseCls:this.uploadCls,browseFilesTriggerEl:this.browseFilesButton.el,dropContainerEl:this.filesGrid.getEl(),multiple:this.multiple,url:this.url});this.mon(this.uploader,"beforefileadd",this._onFileAdd,this);this.mon(this.uploader,"queuechanged",this._onQueueChange,this);this.mon(this.uploader,"uploadstart",this._onUploadStart,this);this.mon(this.uploader,"uploadprogress",this._onUploadProgress,this);this.mon(this.uploader,"uploadfinish",this._onUploadFinish,this);this._bindBrowseButtonEvents();},_onFileAdd:function(c,a,b){if(!this.fileStore.getById(b.getId())){this.fileStore.add(new this.UploadFile(Ext.applyIf({nativeRef:null,percentage:0},b),b.getId()));return true;}return false;},_onQueueChange:function(c,a,b){},_onUploadStart:function(e,f,c,d,b){var a=this.fileStore.getById(c.getId());a.set("status",c.getStatus());a.commit();},_onUploadProgress:function(f,g,e,d,a,c){var b=this.fileStore.getById(e.getId());b.set("percentage",Math.round(a*100));b.commit();},_onUploadFinish:function(e,f,c,d,b){var a=this.fileStore.getById(c.getId());a.set("percentage",100);a.set("status",c.getStatus());a.commit();},_fileProgressColumnRenderer:function(f,e,b,d,g,c){var a=this.uploadCls;return String.format(['<div id="{0}-progress-bar" class="{1}"><div class="{2}" ','style="width: {3}%;"></div></div>'].join(""),b.id,a+"-progress-bar",a+"-progress",b.get("percentage"));},_fileStatusColumnRenderer:function(f,e,b,d,g,c){var a=this.uploadCls+"-status";return String.format('<div id="{0}" class="{0} {0}-{1}" ext:qtip="{2}"></div>',a,b.get("status"),this.getFileStatusMessage(b));},_bindBrowseButtonEvents:function(){this.mon(this.uploader,"browsefilesover",function(b,a){this.browseFilesButton.addClass(["x-btn-over","x-btn-focus"]);},this);this.mon(this.uploader,"browsefilesout",function(b,a){this.browseFilesButton.removeClass(["x-btn-over","x-btn-focus","x-btn-click"]);},this);this.mon(this.uploader,"browsefilesclick",function(b,a){this.browseFilesButton.addClass("x-btn-click");},this);},onDestroy:function(){if(this.rendered){this.uploader.destroy();this.uploader=null;delete this.uploader;Ext.destroyMembers(this,"browseFilesButton","cancelUploadsButton","fileStore","filesGrid","UploadFile");}Ext.ux.jnap.uploader.UploadPanel.superclass.onDestroy.call(this);}});Ext.reg("uploadpanel",Ext.ux.jnap.upload.UploadPanel);
